import _Promise from"babel-runtime/core-js/promise";import fs from"fs";import path from"path";import ReactFiberReconciler from"react-reconciler";import emptyObject from"fbjs/lib/emptyObject";import PDFDocument,{PDFFont}from"@react-pdf/pdfkit";import _Object$keys from"babel-runtime/core-js/object/keys";import _extends from"babel-runtime/helpers/extends";import _objectWithoutProperties from"babel-runtime/helpers/objectWithoutProperties";import isUrl from"is-url";import fontkit from"@react-pdf/fontkit";import fetch from"isomorphic-fetch";import _Array$from from"babel-runtime/core-js/array/from";import emojiRegex from"emoji-regex";import{Attachment,AttributedString,Container,LayoutEngine,Path,Rect}from"@react-pdf/textkit-core";import scriptItemizer from"@react-pdf/script-itemizer";import justificationEngine from"@textkit/justification-engine";import textDecorationEngine from"@textkit/text-decoration-engine";import lineFragmentGenerator from"@textkit/line-fragment-generator";import createLinebreaker from"@textkit/linebreaker";import english from"hyphenation.en-us";import Hypher from"hypher";import _JSON$stringify from"babel-runtime/core-js/json/stringify";import PNG from"@react-pdf/png-js";import _Object$assign from"babel-runtime/core-js/object/assign";import warning from"fbjs/lib/warning";import Yoga from"yoga-layout";import toPairsIn from"lodash.topairsin";import isFunction from"lodash.isfunction";import upperFirst from"lodash.upperfirst";import pick from"lodash.pick";import merge from"lodash.merge";import matchMedia from"media-engine";import createPDFRenderer from"@textkit/pdf-renderer";import BlobStream from"blob-stream";var standardFonts=["Courier","Courier-Bold","Courier-Oblique","Helvetica","Helvetica-Bold","Helvetica-Oblique","Times-Roman","Times-Bold","Times-Italic"];const Buffer=require("buffer/").Buffer,fetchFont=t=>fetch(t).then(t=>t.buffer?t.buffer():t.arrayBuffer()).then(t=>Buffer.from(t));let emojiSource,hyphenationCallback,fonts={};const register=(t,e)=>{let{family:i}=e,r=_objectWithoutProperties(e,["family"]);fonts[i]=_extends({src:t,loaded:!1,loading:!1,data:null},r)},registerHyphenationCallback=t=>{hyphenationCallback=t},registerEmojiSource=({url:t,format:e="png"})=>{emojiSource={url:t,format:e}},getRegisteredFonts=()=>_Object$keys(fonts),getFont=t=>fonts[t],getEmojiSource=()=>emojiSource,getHyphenationCallback=()=>hyphenationCallback,load=async function(t,e){const i=fonts[t];if(i&&!i.data&&!i.loading)if(i.loading=!0,isUrl(i.src)){const t=await fetchFont(i.src);i.data=fontkit.create(t)}else i.data=fontkit.openSync(i.src);if(i&&!i.loaded&&(i.loaded=!0,e.registerFont(t,i.data)),!i&&!standardFonts.includes(t))throw new Error(`Font family not registered: ${t}. Please register it calling Font.register() method.`)},reset=function(){for(const t in fonts)fonts.hasOwnProperty(t)&&(fonts[t].loaded=!1)},clear=function(){fonts={}};var Font={register:register,getEmojiSource:getEmojiSource,getRegisteredFonts:getRegisteredFonts,registerEmojiSource:registerEmojiSource,registerHyphenationCallback:registerHyphenationCallback,getHyphenationCallback:getHyphenationCallback,getFont:getFont,load:load,clear:clear,reset:reset};class StandardFont{constructor(t){this.name=t,this.src=PDFFont.open(null,t),this.glyphs={}}layout(t){const[e,i]=this.src.encode(t);return{positions:i,stringIndices:i.map((t,e)=>e),glyphs:e.map((t,e)=>{const r=this.getGlyph(parseInt(t,16));return r.advanceWidth=i[e].advanceWidth,r})}}glyphForCodePoint(t){const e=this.getGlyph(t);return e.advanceWidth=400,e}getGlyph(t){return this.glyphs[t]||(this.glyphs[t]=this.src.font.characterToGlyph(t)),{id:t,_font:this.src,name:this.glyphs[t]}}hasGlyphForCodePoint(t){return".notdef"!==this.src.font.characterToGlyph(t)}get ascent(){return this.src.ascender}get descent(){return this.src.descender}get lineGap(){return this.src.lineGap}get unitsPerEm(){return 1e3}}var fontSubstitutionEngine=()=>({Run:t})=>(class{constructor(){this.fallbackFontInstance=null}get fallbackFont(){return this.fallbackFontInstance||(this.fallbackFontInstance=new StandardFont("Helvetica")),this.fallbackFontInstance}getRuns(e,i){const r=[];let o=null,s=0,n=0;for(const a of i){let i;if(i="string"==typeof a.attributes.font?new StandardFont(a.attributes.font):a.attributes.font,0===e.length){r.push(new t(0,0,{font:i}));break}for(const h of e.slice(a.start,a.end)){const e=h.codePointAt();let a=i;!i.hasGlyphForCodePoint(e)&&this.fallbackFont.hasGlyphForCodePoint(e)&&(a=this.fallbackFont),a!==o&&(o&&r.push(new t(s,n,{font:o})),o=a,s=n),n+=h.length}}return s<e.length&&r.push(new t(s,e.length,{font:o})),r}});class Node{constructor(t){this.prev=null,this.next=null,this.data=t}toString(){return this.data.toString()}}class LinkedList{constructor(){this.head=null,this.tail=null,this.listSize=0}isLinked(t){return!(t&&null===t.prev&&null===t.next&&this.tail!==t&&this.head!==t||this.isEmpty())}size(){return this.listSize}isEmpty(){return 0===this.listSize}first(){return this.head}last(){return this.last}toString(){return this.toArray().toString()}toArray(){let t=this.head;const e=[];for(;null!==t;)e.push(t),t=t.next;return e}forEach(t){let e=this.head;for(;null!==e;)t(e),e=e.next}contains(t){let e=this.head;if(!this.isLinked(t))return!1;for(;null!==e;){if(e===t)return!0;e=e.next}return!1}at(t){let e=this.head,i=0;if(t>=this.listLength||t<0)return null;for(;null!==e;){if(t===i)return e;e=e.next,i+=1}return null}insertAfter(t,e){return this.isLinked(t)?(e.prev=t,e.next=t.next,null===t.next?this.tail=e:t.next.prev=e,t.next=e,this.listSize+=1,this):this}insertBefore(t,e){return this.isLinked(t)?(e.prev=t.prev,e.next=t,null===t.prev?this.head=e:t.prev.next=e,t.prev=e,this.listSize+=1,this):this}push(t){return null===this.head?this.unshift(t):this.insertAfter(this.tail,t),this}unshift(t){return null===this.head?(this.head=t,this.tail=t,t.prev=null,t.next=null,this.listSize+=1):this.insertBefore(this.head,t),this}remove(t){return this.isLinked(t)?(null===t.prev?this.head=t.next:t.prev.next=t.next,null===t.next?this.tail=t.prev:t.next.prev=t.prev,this.listSize-=1,this):this}pop(){const t=this.tail;return this.tail.prev.next=null,this.tail=this.tail.prev,this.listSize-=1,t.prev=null,t.next=null,t}shift(){const t=this.head;return this.head.next.prev=null,this.head=this.head.next,this.listSize-=1,t.prev=null,t.next=null,t}}LinkedList.Node=Node;const linebreak=(t,e,i)=>{const r={demerits:{line:i&&i.demerits&&i.demerits.line||10,flagged:i&&i.demerits&&i.demerits.flagged||100,fitness:i&&i.demerits&&i.demerits.fitness||3e3},tolerance:i&&i.tolerance||3},o=new LinkedList,s={width:0,stretch:0,shrink:0},n=e,a=[];let h={data:{demerits:1/0}};function l(t,e,i,r,o,s,n){return{position:t,demerits:e,ratio:i,line:r,fitnessClass:o,totals:s||{width:0,stretch:0,shrink:0},previous:n}}function d(e,i,r,o){let a=s.width-r.totals.width,h=0,l=0;const d=o<n.length?n[o-1]:n[n.length-1];return"penalty"===t[i].type&&(a+=t[i].width),a<d?(h=s.stretch-r.totals.stretch)>0?(d-a)/h:linebreak.infinity:a>d?(l=s.shrink-r.totals.shrink)>0?(d-a)/l:linebreak.infinity:0}function g(e){const i={width:s.width,stretch:s.stretch,shrink:s.shrink};for(let r=e;r<t.length;r+=1)if("glue"===t[r].type)i.width+=t[r].width,i.stretch+=t[r].stretch,i.shrink+=t[r].shrink;else if("box"===t[r].type||"penalty"===t[r].type&&t[r].penalty===-linebreak.infinity&&r>e)break;return i}function p(t,e,i){let s,n,a,h,p,c=o.first(),u=null,m=0,f=0,b=[],y=0,E=0;for(;null!==c;){for(b=[{demerits:1/0},{demerits:1/0},{demerits:1/0},{demerits:1/0}];null!==c&&(u=c.next,y=c.data.line+1,((m=d(c.data.position,e,c.data,y))<-1||"penalty"===t.type&&t.penalty===-linebreak.infinity)&&o.remove(c),m>=-1&&m<=r.tolerance&&(s=100*Math.pow(Math.abs(m),3),f="penalty"===t.type&&t.penalty>=0?Math.pow(r.demerits.line+s,2)+Math.pow(t.penalty,2):"penalty"===t.type&&t.penalty!==-linebreak.infinity?Math.pow(r.demerits.line+s,2)-Math.pow(t.penalty,2):Math.pow(r.demerits.line+s,2),"penalty"===t.type&&"penalty"===i[c.data.position].type&&(f+=r.demerits.flagged*t.flagged*i[c.data.position].flagged),E=m<-.5?0:m<=.5?1:m<=1?2:3,Math.abs(E-c.data.fitnessClass)>1&&(f+=r.demerits.fitness),(f+=c.data.demerits)<b[E].demerits&&(b[E]={active:c,demerits:f,ratio:m})),!(null!==(c=u)&&c.data.line>=y)););for(n=g(e),a=0;a<b.length;a+=1)(h=b[a]).demerits<1/0&&(p=new LinkedList.Node(l(e,h.demerits,h.ratio,h.active.data.line+1,a,n,h.active)),null!==c?o.insertBefore(c,p):o.push(p))}}if(o.push(new LinkedList.Node(l(0,0,0,0,0,void 0,null))),t.forEach((t,e,i)=>{"box"===t.type?s.width+=t.width:"glue"===t.type?(e>0&&"box"===i[e-1].type&&p(t,e,i),s.width+=t.width,s.stretch+=t.stretch,s.shrink+=t.shrink):"penalty"===t.type&&t.penalty!==linebreak.infinity&&p(t,e,i)}),0!==o.size()){for(o.forEach(t=>{t.data.demerits<h.data.demerits&&(h=t)});null!==h;)a.push({position:h.data.position,ratio:h.data.ratio}),h=h.data.previous;return a.reverse()}return[]};linebreak.infinity=1e4,linebreak.glue=((t,e,i)=>({type:"glue",width:t,stretch:e,shrink:i})),linebreak.box=((t,e,i=!1)=>({type:"box",width:t,value:e,hyphenated:i})),linebreak.penalty=((t,e,i)=>({type:"penalty",width:t,penalty:e,flagged:i}));const SOFT_HYPHEN_HEX="­",NO_BREAK_SPACE_DECIMAL=160,getWords=t=>{const e=[],{start:i}=t;let r=0;for(const o of t){const{index:s}=o;if(160!==t.codePointAtGlyphIndex(s)&&t.isWhiteSpace(s-i)){const o=t.slice(r,s-i);o.length>0&&e.push(o),r=s-i+1}}if(r<t.end){const i=t.slice(r,t.end-t.start);e.push(i)}return e},h=new Hypher(english),hyphenateString=t=>t.includes("­")?t.split("­"):h.hyphenate(t),hyphenateWord=t=>{let e=0;return hyphenateString(t.string).map(i=>{const r=t.slice(e,e+i.length);return e+=i.length,r})},hyphenate=t=>t.map(t=>hyphenateWord(t)),formatter=(t,e,i)=>{const r=t(" "),o=t("-"),s=e&&"justify"!==e?600:100,n=3,a=6,h=9;return e=>{const l=[],d=getWords(e),g=r*n/a,p=r*n/h;return(i||hyphenate)(d,e).forEach((e,i,n)=>{e.length>1?e.forEach((i,r,n)=>{const a=r===e.length-1;l.push(linebreak.box(t(i),i,!a)),r!==n.length-1&&l.push(linebreak.penalty(o,s,1))}):l.push(linebreak.box(t(e[0]),e[0])),i===n.length-1?(l.push(linebreak.glue(0,linebreak.infinity,0)),l.push(linebreak.penalty(0,-linebreak.infinity,1))):l.push(linebreak.glue(r,g,p))}),l}},HYPHEN=45,TOLERANCE_LIMIT=40;var lineBreaker=({hyphenationCallback:t}={})=>e=>{const i=new(createLinebreaker()(e));return class{constructor(t){this.tolerance=t||4}suggestLineBreak(e,r,o){let s=this.tolerance;const n=this.measureWidth(e),a=formatter(n,o.align,t)(e);let h=[];for(;0===h.length&&s<40;)h=linebreak(a,[r],{tolerance:s}),s+=2;if(0===h.length){const t=i.suggestLineBreak(e,r,o);if(t)return t;const s=e.glyphIndexAtOffset(r)-1;return e.insertGlyph(s,45),{position:s+1}}if(!h[1])return{position:e.end};const l=this.findBreakNode(a,h[1].position),d=l.value.end-e.start;return l.hyphenated?(e.insertGlyph(d,45),{position:d+1}):{position:d+(e.isWhiteSpace(d)?1:0)}}measureWidth(t){const{font:e,fontSize:i}=t.glyphRuns[0].attributes;return t=>{if("string"==typeof t){const r=i/e.unitsPerEm;return e.layout(t).positions[0].xAdvance*r}return t.advanceWidth}}findBreakNode(t,e){let i=e-1;for(;!t[i].value;)i-=1;return t[i]}}};const shrinkWhitespaceFactor={before:-.5,after:-.5};class LayoutEngine$1 extends LayoutEngine{constructor({hyphenationCallback:t}){super({scriptItemizer:scriptItemizer(),decorationEngine:textDecorationEngine(),lineFragmentGenerator:lineFragmentGenerator(),fontSubstitutionEngine:fontSubstitutionEngine(),lineBreaker:lineBreaker({hyphenationCallback:t}),justificationEngine:justificationEngine({shrinkWhitespaceFactor:shrinkWhitespaceFactor})})}}const MARKERS=[65472,65473,65474,65475,65477,65478,65479,65480,65481,65482,65483,65484,65485,65486,65487];class JPEG{constructor(t){if(this.data=null,this.width=null,this.height=null,this.data=t,65496!==t.readUInt16BE(0))throw new Error("SOI not found in JPEG");let e,i=2;for(;i<t.length&&(e=t.readUInt16BE(i),i+=2,!MARKERS.includes(e));)i+=t.readUInt16BE(i);if(!MARKERS.includes(e))throw new Error("Invalid JPEG.");i+=3,this.height=t.readUInt16BE(i),i+=2,this.width=t.readUInt16BE(i)}}const Buffer$1=require("buffer/").Buffer;function getImage(t,e){switch(e.toLowerCase()){case"jpg":case"jpeg":return new JPEG(t);case"png":return new PNG(t);default:return null}}const fetchImage=t=>{if("object"==typeof t){if(t.data&&t.format)return new _Promise((e,i)=>e(getImage(t.data,t.format)));throw new Error(`Invalid data given for local file: ${_JSON$stringify(t)}`)}return fetch(t).then(t=>t.buffer?t.buffer():t.arrayBuffer()).then(t=>"Buffer"===t.constructor.name?t:Buffer$1.from(t)).then(t=>{const e=137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7],i=255===t[0]&&216===t[1]&&255===t[2];let r="";if(e)r="png";else{if(!i)throw new Error("Not valid image extension");r="jpg"}return getImage(t,r)}).catch(()=>{throw new Error(`Couldn't fetch image: ${t}`)})},emojis={},regex=emojiRegex(),reflect=t=>(...e)=>t(...e).then(t=>t,t=>t),fetchEmojiImage=reflect(fetchImage),getCodePoints=t=>_Array$from(t).map(t=>t.codePointAt(0).toString(16)).join("-"),buildEmojiUrl=t=>{const{url:e,format:i}=Font.getEmojiSource();return`${e}${getCodePoints(t)}.${i}`},fetchEmojis=t=>{const e=Font.getEmojiSource();if(!e||!e.url)return[];const i=[];let r;for(;r=regex.exec(t);){const t=r[0];if(!emojis[t]||emojis[t].loading){const e=buildEmojiUrl(t);emojis[t]={loading:!0},i.push(fetchEmojiImage(e).then(e=>{emojis[t].loading=!1,emojis[t].data=e.data}))}}return i},embedEmojis=t=>{const e=[];for(let i=0;i<t.length;i++){const r=t[i];let o,s=0;for(;o=regex.exec(r.string);){const t=o.index,i=o[0],n=r.attributes.fontSize,a=r.string.slice(s,t+o[0].length);emojis[i]&&emojis[i].data?e.push({string:a.replace(o,Attachment.CHARACTER),attributes:_extends({},r.attributes,{attachment:new Attachment(n,n,{yOffset:Math.floor(.1*n),image:emojis[i].data})})}):e.push({string:a.replace(o,String.fromCharCode(0)),attributes:r.attributes}),s=t+i.length}s<r.string.length&&e.push({string:r.string.slice(s),attributes:r.attributes})}return e};class Document$1{constructor(t,e){this.root=t,this.props=e,this.children=[]}get name(){return"Document"}get pageCount(){return this.children.reduce((t,e)=>t+e.subpagesCount,0)}appendChild(t){t.parent=this,t.previousPage=this.children[this.children.length-1],this.children.push(t)}removeChild(t){const e=this.children.indexOf(t);t.parent=null,this.children[e+1]&&(this.children[e+1].previousPage=this.children[e].previousPage),this.children.slice(e,1)}addMetaData(){const{title:t,author:e,subject:i,keywords:r,creator:o,producer:s}=this.props;t&&(this.root.info.Title=t),e&&(this.root.info.Author=e),i&&(this.root.info.Subject=i),r&&(this.root.info.Keywords=r),this.root.info.Creator=o||"react-pdf",this.root.info.Producer=s||"react-pdf"}async loadFonts(){const t=[],e=this.children.slice(0);for(;e.length>0;){const i=e.shift();i.style&&i.style.fontFamily&&t.push(Font.load(i.style.fontFamily,this.root)),i.children&&i.children.forEach(t=>{e.push(t)})}await _Promise.all(t)}async loadEmojis(){const t=[],e=this.children.slice(0);for(;e.length>0;){const i=e.shift();"string"==typeof i?t.push(...fetchEmojis(i)):i.children&&i.children.forEach(t=>{e.push(t)})}await _Promise.all(t)}async loadImages(){const t=[],e=this.children.slice(0);for(;e.length>0;){const i=e.shift();"Image"===i.name&&t.push(i.fetch()),i.children&&i.children.forEach(t=>{e.push(t)})}await _Promise.all(t)}async loadAssets(){await _Promise.all([this.loadFonts(),this.loadImages()])}applyProps(){for(let t=0;t<this.children.length;t++)this.children[t].applyProps()}async wrapChildren(){for(let t=0;t<this.children.length;t++)await this.children[t].wrapPage()}async renderChildren(){for(let t=0;t<this.children.length;t++)await this.children[t].render()}async render(){try{this.addMetaData(),this.applyProps(),await this.loadEmojis(),await this.loadAssets(),await this.wrapChildren(),await this.renderChildren(),this.root.end(),Font.reset()}catch(t){throw t}}}Document$1.defaultProps={author:null,keywords:null,subject:null,title:null};const ALMOST_ZERO=1e-6;class Node$1{constructor(t,e){this._top=null,this._left=null,this._width=null,this._heigth=null,this._padding={},this._margin={},this.layout=Yoga.Node.createDefault()}get top(){return this._top||(this._top=this.layout.getComputedLayout().top-this.marginTop),this._top}get left(){return this._left||(this._left=this.layout.getComputedLayout().left-this.marginLeft),this._left}get width(){return this._width||(this._width=this.layout.getComputedLayout().width+this.marginLeft+this.marginRight),this._width}get height(){return this._heigth||(this._heigth=this.layout.getComputedLayout().height+this.marginTop+this.marginBottom),this._heigth}get paddingTop(){return this._padding.top||(this._padding.top=this.layout.getComputedPadding(Yoga.EDGE_TOP)),this._padding.top}get paddingRight(){return this._padding.right||(this._padding.right=this.layout.getComputedPadding(Yoga.EDGE_RIGHT)),this._padding.right}get paddingBottom(){return this._padding.bottom||(this._padding.bottom=this.layout.getComputedPadding(Yoga.EDGE_BOTTOM)),this._padding.bottom}get paddingLeft(){return this._padding.left||(this._padding.left=this.layout.getComputedPadding(Yoga.EDGE_LEFT)),this._padding.left}get marginTop(){return this._margin.top||(this._margin.top=this.layout.getComputedMargin(Yoga.EDGE_TOP)),this._margin.top}get marginRight(){return this._margin.right||(this._margin.right=this.layout.getComputedMargin(Yoga.EDGE_RIGHT)),this._margin.right}get marginBottom(){return this._margin.bottom||(this._margin.bottom=this.layout.getComputedMargin(Yoga.EDGE_BOTTOM)),this._margin.bottom}get marginLeft(){return this._margin.left||(this._margin.left=this.layout.getComputedMargin(Yoga.EDGE_LEFT)),this._margin.left}get padding(){return{top:this.paddingTop,right:this.paddingRight,bottom:this.paddingBottom,left:this.paddingLeft}}get margin(){return{top:this.marginTop,right:this.marginRight,bottom:this.marginBottom,left:this.marginLeft}}set top(t){0===t&&(t=ALMOST_ZERO),this._top=t}set left(t){0===t&&(t=ALMOST_ZERO),this._left=t}set width(t){0===t&&(t=ALMOST_ZERO),this._width=t}set height(t){0===t&&(t=ALMOST_ZERO),this._heigth=t}set paddingTop(t){0===t&&(t=ALMOST_ZERO),this._padding.top=t}set paddingRight(t){0===t&&(t=ALMOST_ZERO),this._padding.right=t}set paddingBottom(t){0===t&&(t=ALMOST_ZERO),this._padding.bottom=t}set paddingLeft(t){0===t&&(t=ALMOST_ZERO),this._padding.left=t}set marginTop(t){0===t&&(t=ALMOST_ZERO),this._margin.top=t}set marginRight(t){0===t&&(t=ALMOST_ZERO),this._margin.right=t}set marginBottom(t){0===t&&(t=ALMOST_ZERO),this._margin.bottom=t}set marginLeft(t){0===t&&(t=ALMOST_ZERO),this._margin.left=t}set padding(t){this._padding=t}set margin(t){this._margin=t}reset(){this.top=null,this.left=null,this.width=null,this.height=null,this.padding={},this.margin={}}}const yogaValue=(t,e)=>{const i=t=>"alignItems"===t||"alignContent"===t||"alignSelf"===t;switch(e){case"auto":if("alignSelf"===t)return Yoga.ALIGN_AUTO;break;case"flex":return Yoga.DISPLAY_FLEX;case"none":return Yoga.DISPLAY_NONE;case"row":return Yoga.FLEX_DIRECTION_ROW;case"row-reverse":return Yoga.FLEX_DIRECTION_ROW_REVERSE;case"column":return Yoga.FLEX_DIRECTION_COLUMN;case"column-reverse":return Yoga.FLEX_DIRECTION_COLUMN_REVERSE;case"stretch":return Yoga.ALIGN_STRETCH;case"baseline":return Yoga.ALIGN_BASELINE;case"space-around":if("justifyContent"===t)return Yoga.JUSTIFY_SPACE_AROUND;if(i(t))return Yoga.ALIGN_SPACE_AROUND;break;case"space-between":if("justifyContent"===t)return Yoga.JUSTIFY_SPACE_BETWEEN;if(i(t))return Yoga.ALIGN_SPACE_BETWEEN;break;case"around":return Yoga.JUSTIFY_SPACE_AROUND;case"between":return Yoga.JUSTIFY_SPACE_BETWEEN;case"wrap":return Yoga.WRAP_WRAP;case"wrap-reverse":return Yoga.WRAP_WRAP_REVERSE;case"nowrap":return Yoga.WRAP_NO_WRAP;case"flex-start":if("justifyContent"===t)return Yoga.JUSTIFY_FLEX_START;if(i(t))return Yoga.ALIGN_FLEX_START;break;case"flex-end":if("justifyContent"===t)return Yoga.JUSTIFY_FLEX_END;if(i(t))return Yoga.ALIGN_FLEX_END;break;case"center":if("justifyContent"===t)return Yoga.JUSTIFY_CENTER;if(i(t))return Yoga.ALIGN_CENTER;break;default:return e}},hasOwnProperty=Object.prototype.hasOwnProperty,styleShortHands={margin:{marginTop:!0,marginRight:!0,marginBottom:!0,marginLeft:!0},marginHorizontal:{marginLeft:!0,marginRight:!0},marginVertical:{marginTop:!0,marginBottom:!0},padding:{paddingTop:!0,paddingRight:!0,paddingBottom:!0,paddingLeft:!0},paddingHorizontal:{paddingLeft:!0,paddingRight:!0},paddingVertical:{paddingTop:!0,paddingBottom:!0},border:{borderTopColor:!0,borderTopStyle:!0,borderTopWidth:!0,borderRightColor:!0,borderRightStyle:!0,borderRightWidth:!0,borderBottomColor:!0,borderBottomStyle:!0,borderBottomWidth:!0,borderLeftColor:!0,borderLeftStyle:!0,borderLeftWidth:!0},borderTop:{borderTopColor:!0,borderTopStyle:!0,borderTopWidth:!0},borderRight:{borderRightColor:!0,borderRightStyle:!0,borderRightWidth:!0},borderBottom:{borderBottomColor:!0,borderBottomStyle:!0,borderBottomWidth:!0},borderLeft:{borderLeftColor:!0,borderLeftStyle:!0,borderLeftWidth:!0},borderColor:{borderTopColor:!0,borderRightColor:!0,borderBottomColor:!0,borderLeftColor:!0},borderRadius:{borderTopLeftRadius:!0,borderTopRightRadius:!0,borderBottomRightRadius:!0,borderBottomLeftRadius:!0},borderStyle:{borderTopStyle:!0,borderRightStyle:!0,borderBottomStyle:!0,borderLeftStyle:!0},borderWidth:{borderTopWidth:!0,borderRightWidth:!0,borderBottomWidth:!0,borderLeftWidth:!0}},expandStyles=t=>{if(!t)return t;const e=_Object$keys(t),i={};for(let r=0;r<e.length;r++){const o=e[r],s=t[o];switch(o){case"display":case"flex":case"flexDirection":case"flexWrap":case"flexFlow":case"flexGrow":case"flexShrink":case"flexBasis":case"justifyContent":case"alignSelf":case"alignItems":case"alignContent":case"order":i[o]=yogaValue(o,s);break;case"textAlignVertical":i.verticalAlign="center"===s?"middle":s;break;case"margin":case"marginHorizontal":case"marginVertical":case"padding":case"paddingHorizontal":case"paddingVertical":case"border":case"borderTop":case"borderRight":case"borderBottom":case"borderLeft":case"borderColor":case"borderRadius":case"borderStyle":case"borderWidth":{const t=styleShortHands[o];for(const e in t)hasOwnProperty.call(t,e)&&(i[e]=s)}break;default:i[o]=s}}return i},matchBorderShorthand=t=>t.match(/(\d+)px?\s(\S+)\s(\S+)/),processBorders=t=>{const e=_Object$keys(t),i={};for(let r=0;r<e.length;r++){const o=e[r],s=t[o];if("string"==typeof s&&o.match(/border/)){const t=matchBorderShorthand(s);if(t)if(o.match(/.Color/))i[o]=t[3];else if(o.match(/.Style/))i[o]=t[2];else{if(!o.match(/.Width/))throw new Error(`StyleSheet: Invalid '${s}' for '${o}'`);i[o]=t[1]}else i[o]=s}else i[o]=s}return i},transformStyles=t=>processBorders(expandStyles(t)),create=t=>t,flatten=t=>{return Array.isArray(t)||(t=[t]),t.reduce((t,e)=>(e&&_Object$keys(e).forEach(i=>{null===e[i]&&void 0===e[i]||(t[i]=e[i])}),t),{})},resolveMediaQueries=(t,e)=>{return _Object$keys(t).reduce((i,r)=>/@media/.test(r)?_extends({},i,matchMedia({[r]:t[r]},e)):_extends({},i,{[r]:t[r]}),{})},resolve=(t,e)=>t?(t=flatten(t),t=resolveMediaQueries(t,e),transformStyles(t)):null,absoluteFillObject={position:"absolute",top:0,left:0,bottom:0,right:0};var StyleSheet={hairlineWidth:1,create:create,resolve:resolve,flatten:flatten,absoluteFillObject:absoluteFillObject};const Debug={debugText(t){this.root.fontSize(4),this.root.opacity(1),this.root.fillColor("black"),this.root.text(`${t.width} x ${t.height}`,t.left,Math.max(t.top-4,0))},debugContent(t,e,i){this.root.fillColor("#a1c6e7"),this.root.opacity(.5),this.root.rect(t.left+i.left+e.left,t.top+i.top+e.top,t.width-i.left-i.right-e.left-e.right,t.height-i.top-i.bottom-e.top-e.bottom).fill()},debugPadding(t,e,i){this.root.fillColor("#c4deb9"),this.root.opacity(.5),this.root.rect(t.left+e.left+i.left,t.top+e.top,t.width-i.right-i.left-e.left-e.right,i.top).fill(),this.root.rect(t.left+e.left,t.top+e.top,i.left,t.height-e.top-e.bottom).fill(),this.root.rect(t.left+t.width-i.right-e.right,t.top+e.top,i.right,t.height-e.top-e.bottom).fill(),this.root.rect(t.left+i.left+e.left,t.top+t.height-i.bottom-e.bottom,t.width-i.right-i.left-e.left-e.right,i.bottom).fill()},debugMargin(t,e){this.root.fillColor("#f8cca1"),this.root.opacity(.5),this.root.rect(t.left+e.left,t.top,t.width-e.left-e.right,e.top).fill(),this.root.rect(t.left,t.top,e.left,t.height).fill(),this.root.rect(t.left+t.width-e.right,t.top,e.right,t.height).fill(),this.root.rect(t.left+e.left,t.top+t.height-e.bottom,t.width-e.left-e.right,e.bottom).fill()},debug(){const t=this.getAbsoluteLayout(),e=this.padding,i=this.margin;this.root.save(),this.debugContent(t,i,e),this.debugPadding(t,i,e),this.debugMargin(t,i),this.debugText(t),this.root.restore()}},Borders={traceBorder(t,e){switch(t){case"dashed":this.root.dash(2*e,{space:1.2*e}).stroke();break;case"dotted":this.root.dash(e,{space:1.2*e}).stroke();break;default:this.root.stroke()}},drawHorizontalBorder(t,e,i,r,o,s,n){o<=0||(this.root.lineWidth(o).moveTo(t[0],t[1]+i).quadraticCurveTo(t[0],t[1],t[0]+i,t[1]).lineTo(e[0]-r,e[1]).quadraticCurveTo(e[0],e[1],e[0],e[1]+r).strokeColor(s),this.traceBorder(n,o))},drawVerticalBorder(t,e,i,r,o,s,n){o<=0||(this.root.lineWidth(o).moveTo(t[0]+i,t[1]).quadraticCurveTo(t[0],t[1],t[0],t[1]-i).lineTo(e[0],e[1]+r).quadraticCurveTo(e[0],e[1],e[0]+r,e[1]).strokeColor(s),this.traceBorder(n,o))},drawBorders(){const t=this.margin,{left:e,top:i,width:r,height:o}=this.getAbsoluteLayout(),{borderTopWidth:s=0,borderRightWidth:n=0,borderBottomWidth:a=0,borderLeftWidth:h=0,borderTopLeftRadius:l=0,borderTopRightRadius:d=0,borderBottomRightRadius:g=0,borderBottomLeftRadius:p=0,borderTopColor:c="black",borderRightColor:u="black",borderBottomColor:m="black",borderLeftColor:f="black",borderTopStyle:b="solid",borderRightStyle:y="solid",borderBottomStyle:E="solid",borderLeftStyle:_="solid"}=this.getComputedStyles();this.root.save(),this.drawHorizontalBorder([e+t.left+(l>0?s/2:0),i+t.top+s/2],[e+r-t.right-(d>0?s/2:0),i+t.top+s/2],l,d,s,c,b),this.drawVerticalBorder([e+r-t.right-n/2,i+t.top+(d>0?n/2:0)],[e+r-t.right-n/2,i+o-t.bottom-(g>0?n/2:0)],-d,-g,n,u,y),this.drawHorizontalBorder([e+r-t.right-(g>0?a/2:0),i+o-t.bottom-a/2],[e+t.left+(p>0?a/2:0),i+o-t.bottom-a/2],-g,-p,a,m,E),this.drawVerticalBorder([e+t.left+h/2,i+o-t.bottom-(p>0?h/2:0)],[e+t.left+h/2,i+t.top+(l>0?h/2:0)],p,l,h,f,_),this.root.restore()}},inheritedProperties=["color","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","textAlign","visibility","wordSpacing"],PERCENT=/^(\d+)?%$/g;class Base extends Node$1{constructor(t,e){super(),this.root=t,this.parent=null,this.children=[],this.props=merge({},this.constructor.defaultProps,Base.defaultProps,e),warning(!this.props.styles,'"styles" prop passed instead of "style" prop'),this.layout=Yoga.Node.createDefault(),this.canBeSplitted=!1}get page(){return this.parent.page}appendChild(t){t&&(t.parent=this,this.children.push(t),this.layout.insertChild(t.layout,this.layout.getChildCount()))}removeChild(t){const e=this.children.indexOf(t);-1!==e&&(t.parent=null,this.children.splice(e,1),this.layout.removeChild(t.layout))}moveTo(t){this.reset(),this.parent.removeChild(this),t.appendChild(this)}applyProps(){const{size:t,orientation:e}=this.page;this.style=this.style||StyleSheet.resolve(this.props.style,{width:t[0],height:t[1],orientation:e}),toPairsIn(this.style).map(([t,e])=>{this.applyStyle(t,e)}),this.children.forEach(t=>{t.applyProps&&t.applyProps()})}setDimension(t,e){const i=`set${upperFirst(t)}`,r=`${i}Percent`,o=PERCENT.exec(e);o?this.layout[r](parseInt(o[1],10)):this.layout[i](e)}setPosition(t,e){const i=PERCENT.exec(e);i?this.layout.setPositionPercent(t,parseInt(i[1],10)):this.layout.setPosition(t,e)}applyStyle(t,e){const i=`set${upperFirst(t)}`;switch(t){case"marginTop":this.layout.setMargin(Yoga.EDGE_TOP,this.marginTop||e);break;case"marginRight":this.layout.setMargin(Yoga.EDGE_RIGHT,this.marginRight||e);break;case"marginBottom":this.layout.setMargin(Yoga.EDGE_BOTTOM,this.marginBottom||e);break;case"marginLeft":this.layout.setMargin(Yoga.EDGE_LEFT,this.marginLeft||e);break;case"paddingTop":this.layout.setPadding(Yoga.EDGE_TOP,this.paddingTop||e);break;case"paddingRight":this.layout.setPadding(Yoga.EDGE_RIGHT,this.paddingRight||e);break;case"paddingBottom":this.layout.setPadding(Yoga.EDGE_BOTTOM,this.paddingBottom||e);break;case"paddingLeft":this.layout.setPadding(Yoga.EDGE_LEFT,this.paddingLeft||e);break;case"borderTopWidth":this.layout.setBorder(Yoga.EDGE_TOP,e);break;case"borderRightWidth":this.layout.setBorder(Yoga.EDGE_RIGHT,e);break;case"borderBottomWidth":this.layout.setBorder(Yoga.EDGE_BOTTOM,e);break;case"borderLeftWidth":this.layout.setBorder(Yoga.EDGE_LEFT,e);break;case"position":this.layout.setPositionType("absolute"===e?Yoga.POSITION_TYPE_ABSOLUTE:Yoga.POSITION_TYPE_RELATIVE);break;case"top":this.setPosition(Yoga.EDGE_TOP,this.top||e);break;case"right":this.setPosition(Yoga.EDGE_RIGHT,this.right||e);break;case"bottom":this.setPosition(Yoga.EDGE_BOTTOM,this.bottom||e);break;case"left":this.setPosition(Yoga.EDGE_LEFT,this.left||e);break;case"width":this.setDimension(t,this[t]-this.marginLeft-this.marginRight||e);break;case"height":this.setDimension(t,this[t]-this.marginTop-this.marginBottom||e);break;case"minHeight":case"maxHeight":case"minWidth":case"maxWidth":this.setDimension(t,e);break;default:isFunction(this.layout[i])&&this.layout[i](e)}}isAbsolute(){return"absolute"===this.props.style.position}isEmpty(){return 0===this.children.length}recalculateLayout(){this.children.forEach(t=>t.recalculateLayout())}getAbsoluteLayout(){const t=this.parent.margin||{left:0,top:0},e=this.parent.getAbsoluteLayout?this.parent.getAbsoluteLayout():{left:0,top:0};return{left:this.left+t.left+e.left,top:this.top+t.top+e.top,height:this.height,width:this.width}}getWidth(){return this.layout.getComputedWidth()+this.layout.getComputedMargin(Yoga.EDGE_LEFT)+this.layout.getComputedMargin(Yoga.EDGE_RIGTH)-this.layout.getComputedPadding(Yoga.EDGE_LEFT)-this.layout.getComputedPadding(Yoga.EDGE_RIGTH)}getHeight(){return this.layout.getComputedHeight()+this.layout.getComputedMargin(Yoga.EDGE_TOP)+this.layout.getComputedMargin(Yoga.EDGE_BOTTOM)-this.layout.getComputedPadding(Yoga.EDGE_TOP)-this.layout.getComputedPadding(Yoga.EDGE_BOTTOM)}getComputedStyles(){let t=this.parent,e={};for(;t&&t.parent;)e=_extends({},t.parent.style,t.style,e),t=t.parent;return _extends({},pick(e,inheritedProperties),this.style)}drawBackgroundColor(){const t=this.margin,{left:e,top:i,width:r,height:o}=this.getAbsoluteLayout(),s=this.getComputedStyles(),n=Math.max(s.borderTopLeftRadius,s.borderTopRightRadius,s.borderBottomRightRadius,s.borderBottomLeftRadius)||0;s.backgroundColor&&this.root.fillColor(s.backgroundColor).roundedRect(e+t.left,i+t.top,r-t.left-t.right,o-t.top-t.bottom,n).fill()}wrapHeight(t){return Math.min(t,this.height)}clone(){const t=new this.constructor(this.root,this.props);return t.width=this.width,t.style=this.style,t.parent=this.parent,t.height=this.height,t.margin=this.margin,t.padding=this.padding,t}async renderChildren(t){const e=this.children.filter(t=>t.isAbsolute()),i=this.children.filter(t=>!t.isAbsolute());for(let e=0;e<i.length;e++)await i[e].render(t);for(let i=0;i<e.length;i++)await e[i].render(t)}}Base.defaultProps={style:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomRightRadius:0,borderBottomLeftRadius:0},minPresenceAhead:0},_Object$assign(Base.prototype,Debug),_Object$assign(Base.prototype,Borders);class SubPage extends Base{constructor(t,e,i){super(t,e),this._number=i}get name(){return"SubPage"}get page(){return this.parent}get size(){return this.parent.size}get style(){return this.parent.style}set style(t){return t}get number(){return this._number+this.page.numberOffset}resetMargins(){(this.style.marginTop||this.style.marginBottom||this.style.marginLeft||this.style.marginRight)&&(warning(!1,"Margin values are not allowed on Page element. Use padding instead."),this.style.marginTop=0,this.style.marginBottom=0,this.style.marginLeft=0,this.style.marginRight=0)}applyProps(){if(super.applyProps(),this.resetMargins(),this.props.size){const t=this.size;"landscape"===this.props.orientation?(this.layout.setWidth(t[1]),this.layout.setHeight(t[0])):(this.layout.setWidth(t[0]),this.layout.setHeight(t[1]))}}recalculateLayout(){super.recalculateLayout(),this.layout.calculateLayout()}isEmpty(){const t=this.children.filter(t=>!t.props.fixed);return 0===t.length||t.every(t=>t.isEmpty())}wrap(t){this.layout.calculateLayout();const e=[],i=this.clone();i._number=this._number+1;for(let r=0;r<this.children.length;r++){const o=this.children[r],{fixed:s,wrap:n,minPresenceAhead:a}=o.props,h=t<o.top,l=t<o.top+o.height-this.paddingTop;if(s){const t=o.clone();t.children=o.children,i.appendChild(t)}else if(h)e.push(o);else{if(o.props.break){o.props.break=!1,e.push(...this.children.slice(r));break}if(a){let i=1,o=0,s=this.children[r+i],n=t>s.top;for(;s&&n;)n=t>s.top,o+=s.wrapHeight(t-s.top-this.marginTop),s=this.children[r+i++];if(o<a){e.push(...this.children.slice(r));break}}else if(l){const r=t-o.top+this.paddingTop;n?i.appendChild(o.splice(r,t)):e.push(o)}}}return e.forEach(t=>t.moveTo(i)),i.applyProps(),i}callChildFunctions(){const t=this.children.slice(0);for(;t.length>0;){const e=t.shift(),{pageCount:i}=this.page.document;if(e.renderCallback){const t=e.renderCallback({totalPages:i,pageNumber:this.number});e.renderCallback=null,e.children=[t]}else e.children&&t.push(...e.children)}}layoutFixedElements(){this.reset(),this.recalculateLayout(),this.children.forEach(t=>{t.props.fixed&&t.reset()})}async render(t){this.root.addPage({size:this.size,layout:this.props.orientation,margin:0}),this.callChildFunctions(),this.layoutFixedElements(),this.style.backgroundColor&&this.root.fillColor(this.style.backgroundColor).rect(0,0,this.root.page.width,this.root.page.height).fill(),this.props.debug&&this.debug(),await this.renderChildren(t),this.page.renderRuler()}}var sizes={"4A0":[4767.87,6740.79],"2A0":[3370.39,4767.87],A0:[2383.94,3370.39],A1:[1683.78,2383.94],A2:[1190.55,1683.78],A3:[841.89,1190.55],A4:[595.28,841.89],A5:[419.53,595.28],A6:[297.64,419.53],A7:[209.76,297.64],A8:[147.4,209.76],A9:[104.88,147.4],A10:[73.7,104.88],B0:[2834.65,4008.19],B1:[2004.09,2834.65],B2:[1417.32,2004.09],B3:[1000.63,1417.32],B4:[708.66,1000.63],B5:[498.9,708.66],B6:[354.33,498.9],B7:[249.45,354.33],B8:[175.75,249.45],B9:[124.72,175.75],B10:[87.87,124.72],C0:[2599.37,3676.54],C1:[1836.85,2599.37],C2:[1298.27,1836.85],C3:[918.43,1298.27],C4:[649.13,918.43],C5:[459.21,649.13],C6:[323.15,459.21],C7:[229.61,323.15],C8:[161.57,229.61],C9:[113.39,161.57],C10:[79.37,113.39],RA0:[2437.8,3458.27],RA1:[1729.13,2437.8],RA2:[1218.9,1729.13],RA3:[864.57,1218.9],RA4:[609.45,864.57],SRA0:[2551.18,3628.35],SRA1:[1814.17,2551.18],SRA2:[1275.59,1814.17],SRA3:[907.09,1275.59],SRA4:[637.8,907.09],EXECUTIVE:[521.86,756],FOLIO:[612,936],LEGAL:[612,1008],LETTER:[612,792],TABLOID:[792,1224]};const RULER_WIDTH=13,RULER_COLOR="white",RULER_FONT_SIZE=5,DEFAULT_RULER_STEPS=50,LINE_WIDTH=.5,LINE_COLOR="gray",GRID_COLOR="#ababab",range=(t,e)=>_Array$from({length:Math.ceil(t/e)},(t,i)=>i*e),matchPercentage=t=>{const e=t.match(/(\d+\.?\d*)%/);return e?100/parseFloat(e[1],10):null},Ruler={getRulerWidth:()=>13,hasHorizontalRuler(){return this.props.ruler||this.props.horizontalRuler},hasVerticalRuler(){return this.props.ruler||this.props.verticalRuler},getHorizontalSteps(){const t=this.props.horizontalRulerSteps||this.props.rulerSteps||50;if("string"==typeof t){const e=matchPercentage(t);if(e){return(this.width-(this.hasVerticalRuler()?13:0))/e}throw new Error("Page: Invalid horizontal steps value")}return t},getVerticalSteps(){const t=this.props.verticalRulerSteps||this.props.rulerSteps||50;if("string"==typeof t){const e=matchPercentage(t);if(e){return(this.height-(this.hasHorizontalRuler()?13:0))/e}throw new Error("Page: Invalid horizontal steps value")}return t},renderRuler(){this.root.save().lineWidth(.5).fontSize(5).opacity(1),this.hasHorizontalRuler()&&this.drawHorizontalRuler(),this.hasVerticalRuler()&&this.drawVerticalRuler(),this.hasHorizontalRuler()&&this.hasVerticalRuler()&&this.root.rect(0,0,12.5,12.5).fill("white"),this.root.restore()},drawHorizontalRuler(){const t=this.hasVerticalRuler()?13:0;this.root.rect(t,0,this.width,13).fill("white").moveTo(this.hasVerticalRuler()?13:0,13).lineTo(this.width,13).stroke("gray");const e=range(this.width,this.getHorizontalSteps());e.map(e=>{this.root.moveTo(t+e,0).lineTo(t+e,13).stroke("gray").fillColor("black").text(`${Math.round(e)}`,t+e+1,1)}),e.map(e=>{0!==e&&this.root.moveTo(t+e,13).lineTo(t+e,this.height).stroke("#ababab")})},drawVerticalRuler(){const t=this.hasHorizontalRuler()?13:0;this.root.rect(0,t,13,this.height).fill("white").moveTo(13,this.hasHorizontalRuler()?13:0).lineTo(13,this.height).stroke("gray");const e=range(this.height,this.getVerticalSteps());e.map(e=>{this.root.moveTo(0,t+e).lineTo(13,t+e).stroke("gray").fillColor("black").text(`${Math.round(e)}`,1,t+e+1)}),e.map(e=>{0!==e&&this.root.moveTo(13,t+e).lineTo(this.width,t+e).stroke("#ababab")})}};class Page$1{constructor(t,e){this.root=t,this.parent=null,this.props=_extends({},Page$1.defaultProps,e),this.previousPage=null,this.children=[],this._size=null,this.addInitialSubpage()}get name(){return"Page"}get document(){return this.parent}get orientation(){return this.props.orientation}get initialSubpage(){return this.children[0]}get subpagesCount(){return this.children.length}get numberOffset(){let t=0,e=this.previousPage;for(;e;)t+=e.subpagesCount,e=e.previousPage;return t}get width(){return this.size[0]}get height(){return this.size[1]}get padding(){return{top:this.style.paddingTop||0,right:this.style.paddingRight||0,bottom:this.style.paddingBottom||0,left:this.style.paddingLeft||0}}get size(){if(this._size)return this._size;const{size:t}=this.props;if("string"==typeof t)this._size=sizes[t.toUpperCase()];else if(Array.isArray(t))this._size=t;else{if("object"!=typeof t||!t.width||!t.height)throw new Error(`Invalid Page size: ${t}`);this._size=[t.width,t.height]}return this.hasHorizontalRuler()&&(this._size[0]+=this.getRulerWidth()),this.hasVerticalRuler()&&(this._size[1]+=this.getRulerWidth()),this._size}applyProps(){this.style=StyleSheet.resolve(this.props.style);const t=this.getRulerWidth(),{paddingTop:e=0,paddingLeft:i=0}=this.style;this.hasHorizontalRuler()&&(this.style.paddingTop=e+t),this.hasVerticalRuler()&&(this.style.paddingLeft=i+t);for(let t=0;t<this.children.length;t++)this.children[t].applyProps()}addInitialSubpage(){const t=new SubPage(this.root,this.props,1);t.parent=this,this.children.push(t)}appendChild(t){this.children[0].appendChild(t)}removeChild(t){this.children[0].removeChild(t)}async wrapPage(){const{paddingTop:t=0,paddingBottom:e=0}=this.style,i=this.height-t-e;let r=this.initialSubpage.wrap(i);for(;this.props.wrap&&!r.isEmpty();)this.children.push(r),r=r.wrap(i)}async render(){for(let t=0;t<this.children.length;t++)await this.children[t].render(this)}}Page$1.defaultProps={size:"A4",orientation:"portrait",style:{},wrap:!1},_Object$assign(Page$1.prototype,Ruler);class View$1 extends Base{get name(){return"View"}isEmpty(){return 0!==this.children.length&&this.children.every(t=>t.isEmpty())}wrapHeight(t){const{wrap:e}=this.props;if(!e&&t<this.height)return 0;let i=0;for(let e=0;e<this.children.length&&!(this.children.height>t);e++)i+=this.children.height;return i}splice(t,e){const i=[],r=this.clone();for(let o=0;o<this.children.length;o++){const s=this.children[o],{fixed:n,wrap:a,minPresenceAhead:h}=s.props,l=t<s.top,d=t<s.top+s.height;if(l)i.push(s);else if(n){const t=s.clone();t.children=s.children,r.appendChild(t)}else{if(s.props.break){s.props.break=!1,i.push(...this.children.slice(o));break}if(h){let e=1,r=0,s=this.children[o+e],n=t>s.top;for(;s&&n;)n=t>s.top,r+=s.wrapHeight(t-s.top-this.marginTop),s=this.children[o+e++];if(r<h){i.push(...this.children.slice(o));break}}else if(d){const o=t-s.top-this.marginTop;a?r.appendChild(s.splice(o,e)):i.push(s)}}}i.forEach(t=>t.moveTo(r));const o=this.style.height?t:NaN;return r.marginTop=0,r.paddingTop=0,r.height=this.height-o,this.marginBottom=0,this.paddingBottom=0,this.height=o,r}async render(t){this.drawBackgroundColor(),this.drawBorders(),this.props.debug&&this.debug(),await this.renderChildren(t)}}View$1.defaultProps={style:{},wrap:!0};const IGNORABLE_CODEPOINTS=[8232,8233],buildSubsetForFont=t=>IGNORABLE_CODEPOINTS.reduce((e,i)=>t.hasGlyphForCodePoint&&t.hasGlyphForCodePoint(i)?e:[...e,String.fromCharCode(i)],[]),ignoreChars=t=>t.map(t=>{const e=buildSubsetForFont(t.attributes.font),i=new RegExp(e.join("|"));return{string:t.string.replace(i,""),attributes:t.attributes}});let LAYOUT_ENGINE;const INFINITY=99999,PDFRenderer$2=createPDFRenderer({Rect:Rect});class TextEngine{constructor(t){this.element=t,this._container=null,this.start=0,this.end=0,this.computed=!1,this.preprocessors=[ignoreChars,embedEmojis]}get container(){const t=this._container.blocks.reduce((t,e)=>[...t,...e.lines],[]);return _extends({},this._container,{blocks:[{lines:t.splice(this.start,this.end)}]})}get layoutEngine(){return LAYOUT_ENGINE||(LAYOUT_ENGINE=new LayoutEngine$1({hyphenationCallback:Font.getHyphenationCallback()})),LAYOUT_ENGINE}get lines(){return this.container?this.container.blocks.reduce((t,e)=>[...t,...e.lines],[]):[]}get height(){return this._container?this.lines.reduce((t,e)=>t+e.height,0):-1}get width(){return this._container?Math.max(...this.lines.map(t=>t.advanceWidth)):-1}get attributedString(){let t=[];const{color:e="black",fontFamily:i="Helvetica",fontSize:r=18,textAlign:o="left",position:s,top:n,bottom:a,align:h,lineHeight:l,textDecoration:d,textDecorationColor:g,textDecorationStyle:p,textTransform:c}=this.element.getComputedStyles();warning(!h,'"align" style prop will be deprecated on future versions. Please use "textAlign" instead in Text node'),this.element.children.forEach(h=>{if("string"==typeof h){const u=Font.getFont(i),m=u?u.data:i,f=this.transformText(h,c);t.push({string:f,attributes:{font:m,color:e,fontSize:r,align:o,link:this.element.src,underlineStyle:p,underline:"underline"===d,underlineColor:g||e,lineHeight:l?l*r:null,yOffset:"relative"===s?-n||a||0:null}})}else h.engine&&t.push(...h.engine.attributedString)});for(const e of this.preprocessors)t=e(t);return t}lineIndexAtHeight(t){let e=0;for(let i=0;i<this.lines.length;i++){const r=this.lines[i];if(e+r.height>t)return i;e+=r.height}return this.lines.length}heightAtLineIndex(t){let e=0;for(let i=0;i<=t;i++){e+=this.lines[i].height}return e}splice(t){const e=this.clone(),i=this.lineIndexAtHeight(t);return e.start=i,e.end=this.end,this.end=i,e}clone(){const t=new TextEngine(this.element);return t.computed=this.computed,t._container=this._container,t}transformText(t,e){switch(e){case"uppercase":return t.toUpperCase();case"lowercase":return t.toLowerCase();case"capitalize":return upperFirst(t);default:return t}}layout(t,e){if(this.computed)return;const i=(new Path).rect(0,0,t,INFINITY),r=new Container(i),o=AttributedString.fromFragments(this.attributedString).trim();this.layoutEngine.layout(o,[r]);const s=r.blocks.reduce((t,e)=>t+e.lines.length,0);this.computed=!0,this._container=r,this.end=s+1}render(){const t=this.element.margin,e=this.element.padding,{top:i,left:r}=this.element.getAbsoluteLayout(),o=this.lines[0]?this.lines[0].rect.y:0;this.lines.forEach(s=>{s.rect.x+=r+t.left+e.left,s.rect.y+=i+t.top+e.top-o}),new PDFRenderer$2(this.element.root,{outlineLines:!1}).render(this.container)}}const WIDOW_THREASHOLD=20;class Text$1 extends Base{constructor(t,e){super(t,e),this.engine=new TextEngine(this),this.layout.setMeasureFunc(this.measureText.bind(this)),this.renderCallback=e.render}get name(){return"Text"}get src(){return null}appendChild(t){"string"==typeof t?this.children.push(t):(t.parent=this,this.children.push(t))}removeChild(t){this.children=null}measureText(t,e,i,r){return this.renderCallback?{}:e===Yoga.MEASURE_MODE_EXACTLY?(this.engine.layout(t),{height:this.style.flexGrow?NaN:this.engine.height}):e===Yoga.MEASURE_MODE_AT_MOST||r===Yoga.MEASURE_MODE_AT_MOST?(this.engine.layout(t),{height:this.engine.height,width:Math.min(t,this.engine.width)}):{}}getComputedStyles(){const t=super.getComputedStyles();return"Text"===this.parent.name&&"relative"===this.parent.style.position&&(t.top=t.top||this.parent.style.top,t.bottom=t.bottom||this.parent.style.bottom,t.position=t.position||"relative"),t}recalculateLayout(){this.layout.markDirty()}isEmpty(){return 0===this.engine.lines.length}hasOrphans(t,e){return 1===e&&1!==t}hasWidows(t,e){return 1!==t&&t-e==1&&t<WIDOW_THREASHOLD}wrapHeight(t){const{orphans:e,widows:i}=this.props,r=this.engine.lines.length,o=t-this.marginTop-this.paddingTop,s=this.engine.lineIndexAtHeight(o);let n=t;return r<e?n=t:s<e||r<e+i?n=0:r===e+i?n=this.engine.heightAtLineIndex(e-1):r-s<i&&(n=t-this.engine.heightAtLineIndex(i-1)),Math.min(n,this.height)}splice(t){const e=this.wrapHeight(t),i=this.engine.splice(e),r=this.clone();return r.marginTop=0,r.paddingTop=0,r.width=this.width,r.marginBottom=this.marginBottom,r.engine=i,r.engine.element=r,r.height=i.height+this.paddingBottom+this.marginBottom,this.marginBottom=0,this.paddingBottom=0,this.height=t,r}async render(t){this.drawBackgroundColor(),this.drawBorders(),this.engine.computed||this.engine.layout(this.width-this.margin.left-this.margin.right-this.padding.left-this.padding.right),this.props.debug&&this.debug(),this.engine.render()}}Text$1.defaultProps={wrap:!0,widows:2,orphans:2};const PROTOCOL_REGEXP=/^(http|https|ftp|ftps|mailto)\:\/\//i;class Link$1 extends Text$1{get name(){return"Link"}get src(){let{src:t}=this.props;return"string"!=typeof t||t.match(PROTOCOL_REGEXP)||(t=`http://${t}`),t}}Link$1.defaultProps={style:{color:"blue",textDecoration:"underline"}};const SAFETY_HEIGHT=10;class Image$1 extends Base{constructor(t,e){super(t,e),this.image=null,this.layout.setMeasureFunc(this.measureImage.bind(this))}get name(){return"Image"}shouldGrow(){return!!this.getComputedStyles().flexGrow}measureImage(t,e,i,r){const o=this.margin,s=this.page.padding,n=this.page.height-s.top-s.bottom-o.top-o.bottom-SAFETY_HEIGHT;if(e===Yoga.MEASURE_MODE_EXACTLY&&r===Yoga.MEASURE_MODE_UNDEFINED){const e=t/this.ratio;return{height:Math.min(n,e)}}if(r===Yoga.MEASURE_MODE_EXACTLY&&(e===Yoga.MEASURE_MODE_AT_MOST||e===Yoga.MEASURE_MODE_UNDEFINED))return{width:Math.min(i*this.ratio,t)};if(e===Yoga.MEASURE_MODE_EXACTLY&&r===Yoga.MEASURE_MODE_AT_MOST){const e=t/this.ratio;return{height:Math.min(i,n,e)}}if(e===Yoga.MEASURE_MODE_AT_MOST&&r===Yoga.MEASURE_MODE_AT_MOST){const e=Math.min(this.image.width,t);return{width:e,height:e/this.ratio}}return{height:i,width:t}}isEmpty(){return!1}get ratio(){return this.image.data?this.image.width/this.image.height:1}async fetch(){try{this.image=await fetchImage(this.props.src)}catch(t){this.image={width:0,height:0},console.warn(t.message)}}async render(){const t=this.margin,e=this.padding,{left:i,top:r}=this.getAbsoluteLayout();if(this.drawBackgroundColor(),this.drawBorders(),this.props.debug&&this.debug(),this.image.data){const o=this.width-t.right-t.left,s=this.height-t.top-t.bottom,n=Math.min(s*this.ratio,o),a=Math.max((o-n)/2,0);this.root.image(this.image.data,i+e.left+t.left+a,r+e.top+t.top,{width:n-e.left-e.right,height:s-e.top-e.bottom})}}}function createElement(t,e,i){let r;switch(t){case"ROOT":r=new PDFDocument({autoFirstPage:!1});break;case"DOCUMENT":r=new Document$1(i,e);break;case"PAGE":r=new Page$1(i,e);break;case"TEXT":r=new Text$1(i,e);break;case"LINK":r=new Link$1(i,e);break;case"IMAGE":r=new Image$1(i,e);break;case"VIEW":r=new View$1(i,e);break;default:r=void 0}return r}Image$1.defaultProps={wrap:!1};const PDFRenderer=ReactFiberReconciler({appendInitialChild(t,e){t.appendChild?t.appendChild(e):t.document=e},createInstance:(t,e,i)=>createElement(t,e,i),createTextInstance:(t,e,i)=>t,finalizeInitialChildren:(t,e,i)=>!1,getPublicInstance:t=>t,prepareForCommit(){},prepareUpdate:(t,e,i,r)=>!0,resetAfterCommit(){},resetTextContent(t){},getRootHostContext:()=>emptyObject,getChildHostContext:()=>emptyObject,shouldSetTextContent:(t,e)=>!1,now:()=>{},useSyncScheduling:!0,mutation:{appendChild(t,e){t.appendChild?t.appendChild(e):t.document=e},appendChildToContainer(t,e){t.appendChild?t.appendChild(e):t.document=e},insertBefore(t,e,i){},insertInContainerBefore(t,e,i){},removeChild(t,e){t.removeChild(e)},removeChildFromContainer(t,e){t.removeChild&&t.removeChild(e)},commitTextUpdate(t,e,i){i},commitMount(t,e,i){},commitUpdate(t,e,i,r,o){}}}),View="VIEW",Text="TEXT",Link="LINK",Page="PAGE",Image="IMAGE",Document="DOCUMENT",pdf=t=>{return{toBuffer:async function(){return await t.document.render(),t.document.props.onRender&&t.document.props.onRender(),t},toBlob:async function(){await t.document.render();const e=t.pipe(BlobStream());return new _Promise((i,r)=>{e.on("finish",()=>{const r=e.toBlob("application/pdf");t.document.props.onRender&&t.document.props.onRender({blob:r}),i(r)}),e.on("error",r)})},toString:async function(){let e="";const i=t.document.render();return new _Promise(r=>{i.on("data",function(t){e+=t}),i.on("end",function(){t.document.props.onRender&&t.document.props.onRender({string:e}),r(e)})})}}},renderToStream=async function(t){const e=createElement("ROOT"),i=PDFRenderer.createContainer(e);return PDFRenderer.updateContainer(t,i,null),pdf(e).toBuffer()},renderToFile=async function(t,e,i){const r=await renderToStream(t),o=fs.createWriteStream(e);r.pipe(o),await new _Promise((t,s)=>{o.on("finish",()=>{i&&i(r,e),t(r),console.log(`📝  PDF successfully exported on ${path.resolve(e)}`)}),o.on("error",s)})},render=function(t,e,i){return renderToFile(t,e,i)};var node={pdf:pdf,View:View,Text:Text,Link:Link,Page:Page,Font:Font,Image:Image,Document:Document,StyleSheet:StyleSheet,PDFRenderer:PDFRenderer,createElement:createElement,renderToStream:renderToStream,renderToFile:renderToFile,render:render};export{PDFRenderer,View,Text,Link,Page,Font,Image,Document,StyleSheet,createElement,pdf};export default node;
//# sourceMappingURL=react-pdf.es.min.js.map
